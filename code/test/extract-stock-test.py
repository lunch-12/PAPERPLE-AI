# -*- coding: utf-8 -*-
import re
import pandas as pd
from openai import OpenAI
from tqdm import tqdm  # tqdm 라이브러리 임포트
#ollama run llama3.1

# OpenAI 클라이언트 설정
client = OpenAI(
    base_url='http://localhost:11434/v1',
    api_key='ollama',  # required, but unused
)

# 엑셀 파일 읽기
# df = pd.read_excel('./data/article_df_240812.xlsx')

# # 요약된 내용을 담을 리스트 생성
summaries = []
# new_df=df.head(20)
# 'main' 컬럼의 각 문장에 대해 줄바꿈 제거, 800자 내로 자르고 요약 수행
data='''KISDI Perspectives, AI 반도체 시장 현황과 전망 보고서AI 반도체는 기회의 창..세밀한 지원, 플랫폼 지원 필요[이데일리 김현아 기자] 인공지능(AI)의 대중화가 가속화됨에 따라 이를 지원하는 AI 반도체(가속기)가 주목받고 있다. AI 반도체는 시스템 반도체의 한 종류로, 데이터 저장을 주 용도로 하는 메모리 반도체와는 달리 소프트웨어(SW) 기술력이 핵심이다. 우리나라는 메모리 반도체와 파운드리(반도체 위탁생산) 분야에서 글로벌 강자로 자리매김하고 있지만, 시스템 반도체 시장에서는 글로벌 시장 점유율이 2~3%에 불과하다. AI 반도체를 통해 대한민국이 글로벌 반도체 강국으로의 입지를 확대할 수 있을지 주목된다.정보통신정책연구원(KISDI, 원장직무대행 김정언)은 최근 ‘KISDI Perspectives (24-07-01)새로운 기회의 창으로 AI 반도체 시장 현황과 전망’ 보고서를 발간했다.보고서에 따르면, AI 기술의 지속적인 발전과 함께 AI 반도체의 중요성이 크게 증가하고 있다. AI 반도체는 반도체 시장에 새로운 진입자들이 기존 기업들을 추격하거나 대체하여 선도 기업으로 자리매김할 기회를 제공한다.특히, 글로벌 AI 반도체 시장은 두 자릿수의 성장률을 기록하며, 전체 반도체 시장과 시스템 반도체 시장에서 차지하는 비중이 2023년 각각 10.1%와 16.1%에서 2028년에는 20.4%와 35.0%로 대폭 확대될 전망이다.세부 시장별로는 그래픽처리장치(GPU)의 경우, 기존 공급업체인 엔비디아, 인텔, AMD 등이 시장을 주도하고 있으며, AP, 마이크로프로세서, FPGA, ASIC 분야에서는 아마존, 삼성, 애플, 테슬라 등의 빅테크와 스타트업들이 경쟁하고 있다.



반도체 가치사슬의 변화. 출처=KISDIAI 반도체 부상에 따른 가치사슬 변화AI 반도체의 부상은 기존 가치사슬의 변화를 초래하며, 이는 반도체 산업 경쟁 구도와 가치 창출 방식에 큰 영향을 미치고 있다. 주요 가치사슬 영역의 변화는 다음과 같다.EDA (전자 설계 자동화): AI 반도체 설계를 지원하는 EDA 툴의 중요성이 커지며, 제품 포트폴리오의 확대가 필요하다. 복잡하고 미세한 반도체 회로를 설계(디자인)할 수 있는 필수적인 SW 툴 기업으로는 Synopsys, Cadence, Mentor 등이 존재한다.SIP (시스템 인 패키지): 팹리스(Fabless), EDA, SIP 공급업체들이 AI 반도체 SIP 제공을 전략적으로 수행하고 있다. 해외기업으로는 ARM, Synopsys 등이 존재한다.팹리스(Fabless)·종합반도체 업체(IDM): 다양한 수요처에 활용되는 AI 반도체의 고도화로 점유율이 확대되고 있다.디자인 하우스(Design House): AI 반도체 수요 기업에 대한 종합적인 지원 역량이 강화되고 있다.Foundry(위탁생산): AI 반도체 생산 활동에 필요한 부가적 및 보완적 활동을 통합하는 플랫폼 전략이 강화되고 있다.OSAT (아웃소싱 반도체 조립 및 테스트): AI 반도체 성능 향상의 핵심 기술 영역으로서 중요성이 증대하고 있다.AI반도체는 다품종·소량생산될 것KISDI는 보고서에서 AI반도체는 온디바이스 AI의 활성화에 따라 다양화가 진행되고 있다면서, 빅테크 기업들의 AI 반도체 시장 진입이 활발해지고 있다고 전했다.그러면서 AI 반도체 성능 최적화에 필수적인 ‘시스템 소프트웨어’의 전략화가 필요하다고 조언했다. 이미 주요 선도 기업들의 플랫폼화가 시장 변화를 주도하고 있기 때문이다.구글, 아마존, 테슬라, 애플 등 전통적인 반도체 기업이 아닌 인터넷 기업, 자동차 기업 등이 자사의 제품에 탑재하기 위한 AI반도체를 자체적으로 설계하고 개발하는 추세다. 그간 MS·구글·아마존·테슬라·애플·메타 등 글로벌 빅테크 기업은 전문성, 호환성, 안정성 측면에서 기존 반도체 기업의 AI반도체를 사용했으나, 최근 자사 기기·서비스에 특화된 맞춤형 AI반도체를 자체 개발 중이다.이를테면, 오픈AI는 엔비디아 GPU의 고비용·품귀현상 문제 해결할 목적으로 전방위적(IP·메모리·파운드리·투자사 등) 동맹을 모색하기 위해 최대 7조 달러(약 9300조원) 규모 펀딩을 추진하고 있다.자체 생태계 구축 추진에도 당분간 엔비디아 천하다만, 글로벌 빅테크들의 탈 엔비디아 움직임에도 불구하고, 소프트웨어 생태계 구축에는 상당한 시간이 걸릴 전망이다.KISDI는 보고서에서 “엔비디아의 AI 반도체(GPU)는 상당히 높은 가격으로 판매되며, 공급량이 수요를 따라가지 못해 공급난이 발생하고 있다. 이로 인해 빅테크 기업들은 비용 부담이 증가하고 있으며, AI 제품과 서비스의 성능이 서로 다른데도 동일한 엔비디아 AI 반도체를 사용하고 있다. 또한, AI 반도체의 높은 소비 전력도 큰 문제로 지적된다”라고 밝혔다. 또한, 최신 엔비디아 AI 반도체를 주문하고 서비스를 활용하기까지 평균 50주 이상의 리드 타임이 소요된다고 덧붙였다.이어 “AMD와 인텔은 엔비디아와 동등한 성능을 지닌 GPU를 생산하기 위해 노력하고 있지만, 경쟁 업체가 엔비디아와 경쟁하기 위해서는 ‘소프트웨어 생태계’를 구축하는 데 많은 비용과 시간이 소요될 것으로 예상된다”고 설명했다.



AI반도체 수요처 및 기술별 세분화 현황시스템SW의 전략화 지원해야  AI 서비스의 성공은 하드웨어, 시스템 소프트웨어(SW), 응용 소프트웨어(SW)의 최적화에 달려 있으며, 이를 위해 모든 요소가 중요하다. 특히 AI 반도체를 효과적으로 활용하면서 AI 모델 개발을 지원하는 것이 핵심이다.KISDI는 “시스템 소프트웨어의 전략적 중요성이 증가하고 있다”며, “엔비디아는 GPU 성능의 우월함 외에도, GPU 전용 AI 프로그래밍을 지원하는 시스템 소프트웨어인 CUDA를 제공하는 것이 중요하다. 국내외 AI 반도체를 개발하는 팹리스 및 IDM 기업들도 이러한 시스템 소프트웨어를 함께 개발하고 제공하려 하고 있다”고 설명했다.또한, KISDI는 “온디바이스 AI 환경에서는 제한된 자원을 효율적으로 활용하는 것이 중요하며, 특정 애플리케이션에 특화된 시스템 소프트웨어 개발이 요구된다”며, “이는 범용 솔루션이 대응할 수 없는 다양한 애플리케이션별 특성에 대응하기 위해 개별화된 AI 반도체와 시스템 소프트웨어가 필요하다는 것을 의미한다”고 덧붙였다.시스템 앤 패키지(SIP) 선도 기업인 ARM, 전자 설계 자동화(EDA) 선도 기업인 시놉시스(Synopsys), 그리고 파운드리 선도 기업인 TSMC와 삼성은 자사 중심의 생태계를 구축하며 영향력을 확대하고 있다. 특히 파운드리는 주요 빅테크 기업과 팹리스 고객에게 첨단 미세공정 기반의 AI 반도체 생산을 지원할 뿐만 아니라, AI 반도체의 IP 제공, 설계 서비스, 패키징 및 시스템 구성 최적화 등 폭넓은 영역을 지원하고 있다.AI 반도체 설계 및 제조는 단순한 하드웨어 설계와 생산을 넘어, 사용처별 요구를 깊이 이해하고 이에 맞는 AI 반도체를 생산할 수 있어야 한다.



이에 따라 보고서는 AI 반도체 정책의 실효성을 제고하고 제도적 기회의 창을 적극 활용하기 위한 정책적 시사점을 다음과 같이 제안했다:①경쟁력 부족 부문 지원: AI 반도체 수평적 가치사슬의 각 영역별 참여 기업의 경쟁력을 강화하기 위한 지원이 필요하다.②세밀한 지원 정책: AI 반도체의 다양한 수요처 및 다품종·소량 생산 방식에 대응하는 세밀한 지원 정책이 요구된다.③기술 계층별 지원: AI 반도체를 지원하는 다양한 기술 계층의 변화에 대응하기 위한 기술 계층별 지원이 필요하다.④플랫폼 생태계 강화: AI 반도체 설계 및 생산 지원을 위한 선도 기업의 플랫폼 전략 강화와 국내 기업의 플랫폼 구축 및 강화를 지원해야 한다.'''
# 줄바꿈 제거 및 800자 내로 자르기
cleaned_content = data.replace('\n', ' ').replace('\r', '').strip()[:800]

response = client.chat.completions.create(
    model="llama3.1",
    messages=[
        {"role": "system", "content": "다음 뉴스와 가장 관련있는 주식종목의 코드값 1개를 반환해라. 코드만 반환해라.만약 관련 종목이 없다면 빈칸을 반환하라"},
        {"role": "user", "content": cleaned_content}
    ]
)
# 요약된 내용을 리스트에 추가
summary = response.choices[0].message.content
summary = re.sub(r'\s*\n\s*', '\n', summary)  # 여러 줄바꿈을 하나로
summaries.append(summary)

# 새로운 컬럼 'summary'에 요약된 내용 추가
print(summaries)

# for content in tqdm(new_df['main'], desc="Processing"):
#     # 줄바꿈 제거 및 300자 내로 자르기
#     cleaned_content = content.replace('\n', ' ').replace('\r', '').strip()[:800]

#     response = client.chat.completions.create(
#         model="gemma",
#         messages=[
#             {"role": "system", "content": "다음 뉴스와 관련있는 주식종목의 코드값을 반환해라. 만약 관련 종목이 없다면 빈칸을 반환하라"},
#             {"role": "user", "content": cleaned_content}
#         ]
#     )
#     # 요약된 내용을 리스트에 추가
#     summary = response.choices[0].message.content
#     summary = re.sub(r'\s*\n\s*', '\n', summary)  # 여러 줄바꿈을 하나로
#     summaries.append(summary)

# # 새로운 컬럼 'summary'에 요약된 내용 추가
# new_df['summary'] = summaries

# # 결과를 새로운 엑셀 파일로 저장
# new_df.to_excel('./data/article_df_240816_with_summaries.xlsx', index=False)

# print("요약이 완료되고 새로운 파일이 저장되었습니다.")


#답변에 숫자(영문)가 잇다면 그걸 아래에 적용